<input type="hidden" id="{{ form.vars.id }}" name="{{ form.vars.full_name }}"/>

{% set object = form.vars.sonata_admin.admin.subject %}
{% set mapping = object.taxonomyMapping %}
{% if object.isCategoriesFieldMapped %}
  <table class="table">
    <thead>
      <tr>
        <th>Catégories lues depuis le fichier d'origine</th>
        <th style="width:20px"></th>
        <th>Catégories du site</th>
      </tr>
    </thead>
    <tbody class="table-striped">
      {% for originName, mappedName in mapping %}
        <tr>
          <td class="original">{{originName}}</td>
          <td><i class="fa fa-arrow-circle-right"></i></td>
          <td class="mapped"><input type="text" name="taxonomy[{{originName}}]" class="form-control category-selector" value={{mappedName}} /></td>
        </tr>
      {% endfor %}
    </tbody>

  </table>
{% else %}
  <div class="alert alert-info">Veuillez d'abords sélectionner le champs correspondant aux catégories dans l'onglet 'Table de correspondance des champs' puis cliquer sur 'Sauvegarder'</div>
{% endif %}


<script>
  jQuery(document).ready(function() {

    var optionsList = JSON.parse('{{ form.vars.attr["data-options"]|raw }}');
    var formData = []

    for(var key in optionsList) {
      var option = optionsList[key];
      formData.push({id: option['_id'], text: option.name});
    }

    $(".category-selector").select2({
        data: formData
    });

  });
</script>