{% trans_default_domain 'message' %}

{% set contributionType = {
	'-1': 'commons.contributionType.t-1'|trans,
	0:    'commons.contributionType.t0'|trans,
	1:    'commons.contributionType.t1'|trans,
	2:    'commons.contributionType.t2'|trans,
	3:    'commons.contributionType.t3'|trans,
	4:    'commons.contributionType.t4'|trans,
	5:    'commons.contributionType.t5'|trans,
	6:    'commons.contributionType.t6'|trans,
	}
%}
  
{% set userRoles = {
	0: 'commons.userRoles.r0'|trans,
	1: 'commons.userRoles.r1'|trans,
	2: 'commons.userRoles.r2'|trans,
	3: 'commons.userRoles.r3'|trans,
	4: 'commons.userRoles.r4'|trans,
	5: 'commons.userRoles.r5'|trans,
	}
%}

{% set itemValues = {
	'-2': 'commons.userRoles.v-2'|trans,
	'-1': 'commons.userRoles.v-1'|trans,
	0: 'commons.userRoles.v0'|trans,
	1: 'commons.userRoles.v1'|trans,
	2: 'commons.userRoles.v2'|trans,
	}
%}

{% trans_default_domain 'admin' %}

{% if value and (not value.isResolved or showResolved|default(false))%}
	<div class="panel-heading {{ value.votes|length > 0 ? 'body-content' : ''}}" role="tab" id="heading{{value.id}}" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{value.id}}" aria-expanded="true" aria-controls="collapse{{value.id}}">
		{% if value.isAdminContribution %}
			<div class="small-margin">
					{% set title = (value.type == 4) ? contributionType[value.type] : ('elements.fields.status_choices.' ~ value.status)|trans({}, 'admin') %}
					<b>{{ title | upper }}</b>
					par <u>{{ value.getUserDisplayName }}</u>
					<span class="label label-default">{{ userRoles[value.userRole] }}</span>
					<span><i>{{ value.resolvedMessage}}</i><span>
					<div style="float:right">{{ value.updatedAt|date('commons.format'|trans)}}</div>
			</div>
		{% else %}
			<div class="small-margin">
					<b>{{ contributionType[value.type] | upper }}</b>
					<span class="label {{ value.status > 0 ? 'label-success' : value.status == 0 ? 'label-warning' : 'label-danger' }}">{{ ('elements.fields.status_choices.' ~ value.status)|trans({}, 'admin') }}</span>
					{% if value.resolvedMessage %}<span style="padding:0 10px"><i> {{ value.resolvedMessage}} </i></span>{% endif %}
					{% if value.resolvedBy %}<span>(<u>{{value.resolvedBy }}</u>)</span>{% endif %}

					{% if showResolved|default(false) %}
						<div style="float:right">{{ value.updatedAt|date('commons.format'|trans)}}</div>
					{% endif %}
			</div>

			<div class="small-margin">
				{{ 'xx'|trans({'%name%': value.getUserDisplayName})|raw }}
				<span class="label label-default">{{ userRoles[value.userRole] }}</span>
				{{ 'xy'|trans({'%date%': value.createdAt|date('commons.format'|trans)}) }}
			</div>
		{% endif %}

		{% for post in value.webhookPosts %}
			<span class="label label-default">{{ post.numAttempts }}</span>
		{% endfor %}
	</div>

	  {% if value.votes|length > 0 %}
	    <div id="collapse{{value.id}}" class="panel-collapse collapse {{ showResolved|default(false) ? '' : 'in'}}" role="tabpanel" aria-labelledby="heading{{value.id}}">
    		<div class="panel-body" {% if not showResolved|default(false) %}style="border-top: 1px solid #c4c9cc;padding-top: 5px;"{% endif %}>
					<b style="line-height: 3.5rem;">Votes</b> {# TODO Translation #}
					{% for key, vote in value.votes %}
							{% if vote.value is defined %}
								{% set labelClass = vote.value >= 0 ? 'label-success' : 'label-danger' %}
								{% include "admin/partials/display_vote_report_item.html.twig" with {'item': vote} %}
							{% endif %}
					{% endfor %}
				</div>
  		</div>
		{% endif %}

{% endif %}

<style>

div.small-margin { margin-bottom:5px; }

</style>

